@startuml
!theme plain
skinparam packageStyle rectangle
skinparam component {
  BackgroundColor LightBlue
  BorderColor Black
}

package "Telegram Bot Layer" {
  [Bot Handler] as BotHandler
  [Command Processor] as CommandProcessor
  [Message Formatter] as MessageFormatter
}

package "Calendar Service Layer" {
  [Event Manager] as EventManager
  [Reminder Scheduler] as ReminderScheduler
  [Daily Plan Manager] as DailyPlanManager
  [Quiet Hours Manager] as QuietHoursManager
}

package "Integration Layer" {
  [Calendar Sync] as CalendarSync
  [ICS Parser] as ICSParser
  [Google OAuth Handler] as GoogleOAuth
  [Outlook OAuth Handler] as OutlookOAuth
}

package "Data Layer" {
  [Event Repository] as EventRepository
  [User Repository] as UserRepository
  database "SQLite Database" {
    [Events Table] as EventsTable
    [Users Table] as UsersTable
    [Settings Table] as SettingsTable
  }
}

cloud "External APIs" {
  [Telegram Bot API] as TelegramAPI
  [Google Calendar API] as GoogleAPI
  [Outlook Calendar API] as OutlookAPI
  [ICS Calendar Files] as ICSFiles
}

' Telegram Bot Layer connections
BotHandler --> CommandProcessor
CommandProcessor --> EventManager
CommandProcessor --> CalendarSync
CommandProcessor --> DailyPlanManager
CommandProcessor --> UserRepository
BotHandler --> MessageFormatter
MessageFormatter --> TelegramAPI

' Calendar Service Layer connections
EventManager --> EventRepository
EventManager --> ReminderScheduler
EventManager --> DailyPlanManager
ReminderScheduler --> QuietHoursManager
ReminderScheduler --> EventRepository
ReminderScheduler --> MessageFormatter
DailyPlanManager --> EventRepository
DailyPlanManager --> UserRepository
DailyPlanManager --> MessageFormatter
QuietHoursManager --> UserRepository

' Integration Layer connections
CalendarSync --> ICSParser
CalendarSync --> GoogleOAuth
CalendarSync --> OutlookOAuth
CalendarSync --> EventManager
ICSParser --> ICSFiles
GoogleOAuth --> GoogleAPI
GoogleOAuth --> UserRepository
OutlookOAuth --> OutlookAPI
OutlookOAuth --> UserRepository

' Data Layer connections
EventRepository --> EventsTable
UserRepository --> UsersTable
UserRepository --> SettingsTable

@enduml

